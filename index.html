<!DOCTYPE html>
<head>
  <title>Stream</title>
  <script
    defer
    src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
  ></script>
  <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"></script>
  <link rel="stylesheet" href="main.css" />
  <script src="main.js"></script>
</head>
<body>
  <main x-data="App" x-init="handleOnInitializeApp" class="container">
    <section>
      <header>
        <h2>Divis√£o de arquivos de texto</h2>
        <span
          id="source"
          x-show="data.fileSize > 0"
          x-text="data.fileSize"
        ></span>
      </header>

      <form>
        <div class="form-group">
          <label for="sliceType">Dividir por:</label>
          <select
            name="sliceType"
            id="sliceType"
            required
            x-model="data.sliceType"
          >
            <option value="line">Linhas</option>
            <option value="size">Tamanho</option>
          </select>
        </div>
        <div class="form-group" x-show="data.sliceType === 'size'">
          <label for="sliceSize">Tamanho:</label>
          <select
            name="sliceSize"
            id="sliceSize"
            required
            x-model="data.sliceSize"
          >
            <option value="2">2MB</option>
            <option value="4">4MB</option>
            <option value="10">10MB</option>
            <option value="50">50MB</option>
            <option value="100">100MB</option>
          </select>
        </div>
        <div class="form-group" x-show="data.sliceType === 'line'">
          <label for="sliceLines">Linhas:</label>
          <input
            type="number"
            id="sliceLines"
            name="sliceLines"
            max="10000"
            x-model="data.sliceLines"
          />
        </div>
        <div class="form-group">
          <label for="file" x-text='data.fullName ? data.fullName : "Carregue o arquivo"'>Label</label>
          <input
            type="file"
            id="file"
            required
            x-on:change="handleOnChangeFile"
          />
        </div>                
        <div class="status-detail">          
          <p x-text="getStatusText"></p>
        </div>
        <div>
          <button
            x-show="data.status === 'idle'"
            x-on:click="data.file && handleOnFormSubmit()"
            type="button"
          >
            Transformar
          </button>
          <button
            x-show="data.status === 'processing'"
            x-on:click="data.status === 'processing' && handleOnClickTerminate()"
            type="button"
          >
            Interromper
          </button>
          <button
            x-show="data.status === 'stopped' || data.status === 'completed'"
            x-on:click="(data.status === 'stopped' || data.status === 'completed') && handleOnClickClearStatus()"
            type="button"
          >
            Limpar
          </button>
        </div>
      </form>
    </section>
    <section>
      <div x-show="data.files.length > 0">
        <p>Arquivos gerados:</p>
        <ul>
          <template
            x-for="(file,index) in data.files"
            :key="`${file.name}-${index}`"
          >
            <li>
              <a
                :href="file.url"
                :download="file.name"
                target="_blank"
                x-text="file.text"
              ></a>
            </li>
          </template>
        </ul>
      </div>
    </section>
  </main>
</body>
